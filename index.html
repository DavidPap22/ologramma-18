<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>18 anni Davide — AR</title>
<link rel="stylesheet" href="style.css">
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.2/aframe/build/aframe-ar.js"></script>
</head>
<body>

<!-- OVERLAY iniziale -->
<div id="overlay">
  <div id="card">
    <div id="title">18 anni Davide</div>
    <div id="subtitle">Preparazione ologramma — carico presentazione</div>
    <div class="dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
    <div id="tapHint">Tocca lo schermo per avviare</div>
  </div>
</div>

<!-- WhatsApp -->
<div id="whatsapp"><a href="https://wa.me/393331234567" target="_blank" rel="noopener"><img src="whatsapp.png" alt="WhatsApp"></a></div>

<!-- SCENA AR -->
<a-scene embedded vr-mode-ui="enabled: false" renderer="logarithmicDepthBuffer: true;"
         arjs="sourceType: webcam; debugUIEnabled: false;">
  
  <!-- MARKER PERSONALIZZATO -->
  <a-marker type="pattern" url="qr-marker.pat" id="marker">
    
    <!-- OGGETTI FLUTTUANTI -->
    <a-box position="0 0.5 0" color="#ff0000" scale="0.4 0.4 0.4">
      <a-animation attribute="position" to="0 0.8 0" direction="alternate" dur="1200" repeat="indefinite"></a-animation>
    </a-box>
    <a-sphere position="0.5 0.3 0" color="#00ff00" radius="0.15">
      <a-animation attribute="position" to="0.5 0.6 0" direction="alternate" dur="1000" repeat="indefinite"></a-animation>
    </a-sphere>

    <!-- VIDEO TRASPARENTE -->
    <video id="my-video" src="video-demo.webm" loop autoplay playsinline style="display:none"></video>
    <a-plane position="0 0.5 0" rotation="-90 0 0" width="1" height="0.6" material="shader: flat; src: #my-video"></a-plane>

    <!-- TESTO 3D -->
    <a-entity position="0 1.2 0" rotation="-20 0 0" scale="1.6 1.6 1.6">
      <a-text value="Benvenuto!" align="center" color="#ffe6e6" anchor="center"></a-text>
    </a-entity>

  </a-marker>

  <!-- CAMERA -->
  <a-entity camera></a-entity>
</a-scene>

<!-- AUDIO DI SOTTOFONDO -->
<a-entity sound="src: url(musica.mp3); autoplay: false; loop: true; volume: 0.5"></a-entity>

<!-- SCRIPT -->
<script src="script.js"></script>
<script>
(function() {
  const overlay = document.getElementById('overlay');
  const videoEl = document.getElementById('my-video');
  const audioEl = document.querySelector('a-entity[sound]');

  function startAR() {
    if(!overlay) return;
    overlay.style.display = 'none';
    console.log('[AR] Overlay nascosto, presentazione avviata');

    if(videoEl) { videoEl.play(); }
    if(audioEl) { audioEl.components.sound.playSound(); }

    window.removeEventListener('click', startAR);
    window.removeEventListener('touchstart', startAR);
  }

  window.addEventListener('click', startAR);
  window.addEventListener('touchstart', startAR, {passive:true});

  document.addEventListener('DOMContentLoaded', () => {
    const marker = document.getElementById('marker');
    if(marker) {
      marker.addEventListener('markerFound', ()=>console.log('[AR] Marker trovato'));
      marker.addEventListener('markerLost', ()=>console.log('[AR] Marker perso'));
    }
  });
})();
</script>

</body>
</html>